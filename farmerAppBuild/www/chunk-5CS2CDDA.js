import{a as mt,c as dt,ia as _t,q as pt,ta as gt,w as ut}from"./chunk-2E2WOBKK.js";import{A as rt,B as ot,T as at,U as ct,W as lt,d as Y,f as J,g as K,ga as st,h as W,p as X,s as Z,u as tt,v as et,w as nt,x as it}from"./chunk-B7BKEKPT.js";import"./chunk-EKYO6VDW.js";import"./chunk-24IHF5HR.js";import"./chunk-KFDLIPX5.js";import"./chunk-EPJFQAWK.js";import"./chunk-4UA7XWWY.js";import"./chunk-3P4LCZSC.js";import"./chunk-QB2INVK3.js";import"./chunk-T4NRX6V6.js";import"./chunk-R2OJ64UA.js";import"./chunk-RPLHLNGJ.js";import"./chunk-JZD5S6T4.js";import"./chunk-G223UPOJ.js";import"./chunk-ZSV5V4UX.js";import"./chunk-6AR4DOND.js";import"./chunk-67J5UTTO.js";import"./chunk-3QTGG56W.js";import"./chunk-SACCBILY.js";import"./chunk-GYT6Z5WN.js";import{$ as D,Da as q,H as E,Hb as U,I as s,Ib as A,J as v,Ja as F,Ka as z,Kb as G,Lb as Q,M as S,Nb as R,Q as C,Sa as $,Sb as H,T as g,Ub as L,Wa as B,Y as o,Z as r,_ as m,a as w,aa as k,ab as N,ca as x,da as h,ea as p,f as b,h as y,ha as T,n as O,oa as V,p as M,pa as l,qa as j,ra as P,sa as I,u,v as _}from"./chunk-YS7BCJTD.js";import"./chunk-5BIRNKZZ.js";import"./chunk-PN5KWPLT.js";import"./chunk-ZPEM7JC5.js";import"./chunk-AQXWH6LN.js";import"./chunk-XFZJ45JG.js";import"./chunk-QYFRFJTZ.js";import"./chunk-MN6QQCMN.js";import"./chunk-TP642E63.js";import"./chunk-SRRF7I6H.js";import"./chunk-LNJ3S2LQ.js";var ht=(()=>{let c=class c{constructor(e){this.http=e,this.baseUrl="http://127.0.0.1:3000",this.cartSubject=new w(null),this.cart$=this.cartSubject.asObservable()}getCart(e){return this.http.get(`${this.baseUrl}/getCartitems/${e}`).pipe(b(t=>{if(t.status==="error")throw new Error(t.message);return this.cartSubject.next(t.data),t.data}),y(t=>{throw console.error("Error fetching cart:",t),t}))}createCart(e){return this.http.post(`${this.baseUrl}/InsertCartDetails`,e).pipe(b(t=>{if(t.status==="error")throw new Error(t.message);return this.cartSubject.next(t.data),t.data}),y(t=>{throw console.error("Error creating cart:",t),t}))}removeCartItem(e,t,i){let f=i?`${this.baseUrl}/cart/${e}/item/${t}?wholeseller_id=${i}`:`${this.baseUrl}/cart/${e}/item/${t}`;return this.http.delete(f).pipe(b(d=>{if(d.status==="error")throw new Error(d.message);return this.cartSubject.next(d.data),d.data}),y(d=>{throw console.error("Error removing cart item:",d),d}))}getCurrentCart(){return this.cartSubject.value}};c.\u0275fac=function(t){return new(t||c)(M(B))},c.\u0275prov=O({token:c,factory:c.\u0275fac,providedIn:"root"});let a=c;return a})();function xt(a,c){a&1&&(o(0,"span",30),m(1,"ion-icon",31),l(2," Price updated "),r())}function bt(a,c){if(a&1){let n=x();o(0,"ion-card")(1,"div",15)(2,"ion-item",16)(3,"ion-thumbnail",1),m(4,"img",17),r(),o(5,"ion-label")(6,"h2",18),l(7),r(),o(8,"p",19),l(9),r(),o(10,"p",20),l(11),C(12,xt,3,0,"span",21),r()()(),o(13,"ion-item",22)(14,"ion-button",23),h("click",function(){let t=u(n).index,i=p(2);return _(i.decreaseQuantity(t))}),m(15,"ion-icon",24),r(),o(16,"p",25),l(17),r(),o(18,"ion-button",23),h("click",function(){let t=u(n).index,i=p(2);return _(i.increaseQuantity(t))}),m(19,"ion-icon",26),r()()(),o(20,"div",27)(21,"ion-button",28),h("click",function(){let t=u(n).index,i=p(2);return _(i.removeItem(t))}),m(22,"ion-icon",29),r()()()}if(a&2){let n=c.$implicit;s(4),T("alt",n.product_name),g("src","assets/img/"+n.product_name+".png",E),s(3),j(n.product_name),s(2),I(" \u20B9",n.latest_wholesaler_price,"/",n.unit_name," "),s(2),P(" \u20B9",n.latest_wholesaler_price*n.quantity," "),s(),g("ngIf",n.price_while_added!==n.latest_wholesaler_price),s(5),I(" ",n.quantity,"",n.unit_name," ")}}function yt(a,c){if(a&1){let n=x();D(0),o(1,"form",7)(2,"ion-list"),C(3,bt,23,9,"ion-card",8),r(),o(4,"ion-card",9)(5,"ion-item")(6,"ion-label",10),l(7,"Apply Discount Code"),r(),m(8,"ion-input",11),r(),o(9,"ion-button",12),h("click",function(){u(n);let t=p();return _(t.applyDiscount())}),l(10,"Apply Discount"),r()(),o(11,"ion-card",13)(12,"ion-item")(13,"ion-label",10),l(14,"Delivery Date"),r(),m(15,"ion-input",14),r()()(),k()}if(a&2){let n=p();s(),g("formGroup",n.cartForm),s(2),g("ngForOf",n.cartProducts)}}function vt(a,c){a&1&&(o(0,"div",32),m(1,"ion-icon",33),o(2,"p"),l(3,"Your cart is empty"),r()())}function Pt(a,c){if(a&1){let n=x();o(0,"ion-footer")(1,"ion-toolbar")(2,"ion-title"),l(3),r(),o(4,"ion-buttons",34)(5,"ion-button",35),h("click",function(){u(n);let t=p();return _(t.checkout())}),l(6,"Checkout"),r()()()()}if(a&2){let n=p();s(3),P("Total: \u20B9",n.getTotalPrice()-n.discount,"")}}var qt=(()=>{let c=class c{constructor(e,t,i){this.router=e,this.fb=t,this.cartService=i,this.cartDetails=null,this.cartProducts=[],this.discount=0,mt({trashOutline:gt,cartOutline:pt,chevronBack:ut,removeOutline:_t,addOutline:dt}),this.cartForm=this.fb.group({discountCode:[""],deliveryDate:[""]})}ngOnInit(){let e=localStorage.getItem("cartId");e?this.loadCart(Number(e)):this.router.navigate(["/buyer/buyer-home"])}goBack(){this.router.navigate(["/buyer/buyer-home"])}loadCart(e){this.cartService.getCart(e).subscribe({next:t=>{this.cartDetails=t.cart_details,this.cartProducts=t.products},error:t=>{console.error("Error loading cart:",t)}})}getTotalPrice(){return this.cartProducts.reduce((e,t)=>e+t.latest_wholesaler_price*t.quantity,0)}increaseQuantity(e){this.cartProducts[e].quantity++}decreaseQuantity(e){this.cartProducts[e].quantity>1&&this.cartProducts[e].quantity--}removeItem(e){if(!this.cartDetails)return;let t=this.cartProducts[e];this.cartService.removeCartItem(this.cartDetails.cart_id,t.product_id,this.cartDetails.wholeseller_id).subscribe({next:i=>{this.cartProducts=i.products,this.cartDetails=i.cart_details},error:i=>{console.error("Error removing item:",i)}})}applyDiscount(){var i;let e=(i=this.cartForm.get("discountCode"))==null?void 0:i.value,t={SAVE10:10,FRESH20:20};this.discount=t[e]?this.getTotalPrice()*t[e]/100:0}checkout(){var e;this.cartDetails&&this.router.navigate(["/buyer/checkout"],{state:{cartItems:this.cartProducts,totalPrice:this.getTotalPrice()-this.discount,deliveryDate:(e=this.cartForm.get("deliveryDate"))==null?void 0:e.value,retailer:{id:this.cartDetails.retailer_id,name:this.cartDetails.retailer_name,address:this.cartDetails.retailer_address,state:this.cartDetails.retailer_state_name,location:this.cartDetails.retailer_location_name},wholeseller:this.cartDetails.wholeseller_id?{id:this.cartDetails.wholeseller_id,name:this.cartDetails.wholeseller_name}:null}})}};c.\u0275fac=function(t){return new(t||c)(v(N),v(H),v(ht))},c.\u0275cmp=S({type:c,selectors:[["app-cart"]],decls:12,vars:3,consts:[["emptyCart",""],["slot","start"],[3,"click"],["name","chevron-back"],[1,"cart-content"],[4,"ngIf","ngIfElse"],[4,"ngIf"],[3,"formGroup"],[4,"ngFor","ngForOf"],[1,"discount-card"],["position","stacked"],["formControlName","discountCode","placeholder","Enter code"],["color","light",3,"click"],[1,"delivery-card"],["formControlName","deliveryDate","type","datetime-local"],[1,"product-container"],["lines","none",1,"product-info"],[3,"src","alt"],[1,"item-title"],[1,"unit-price"],[1,"item-price"],["class","price-note",4,"ngIf"],["lines","none",1,"quantity-section"],["fill","outline","shape","round",1,"qty-btn",3,"click"],["name","remove-outline"],[1,"quantity-text"],["name","add-outline"],[1,"trash-container"],["fill","clear",3,"click"],["name","trash-outline",1,"trash-icon"],[1,"price-note"],["name","alert-circle-outline"],[1,"empty-cart"],["name","cart-outline",1,"empty-icon"],["slot","end"],["color","success","expand","full",3,"click"]],template:function(t,i){if(t&1){let f=x();o(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1)(3,"ion-button",2),h("click",function(){return u(f),_(i.goBack())}),m(4,"ion-icon",3),r()(),o(5,"ion-title"),l(6,"My Cart"),r()()(),o(7,"ion-content",4),C(8,yt,16,2,"ng-container",5)(9,vt,4,0,"ng-template",null,0,q),r(),C(11,Pt,7,1,"ion-footer",6)}if(t&2){let f=V(10);s(8),g("ngIf",i.cartProducts.length>0)("ngIfElse",f),s(3),g("ngIf",i.cartProducts.length>0)}},dependencies:[$,F,z,st,J,K,W,X,Z,tt,et,nt,it,rt,ot,at,ct,lt,Y,L,G,U,A,Q,R],styles:["ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: radial-gradient(circle, #ffffff 0%, #eef2f3 100%);--color: rgb(174, 172, 172)}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#88ac8c}.cart-content[_ngcontent-%COMP%]{padding:10px}ion-card[_ngcontent-%COMP%]{position:relative;border-radius:12px;box-shadow:0 4px 8px #0000001a;padding:10px}.item-title[_ngcontent-%COMP%]{font-weight:700;font-size:1.1rem}.hindi-name[_ngcontent-%COMP%]{font-size:.9rem;color:#666}.item-price[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;color:#a9e2b1}.discount-text[_ngcontent-%COMP%]{font-size:1rem;color:#88ac8c;margin-left:8px}.quantity-section[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:10px}.quantity-text[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;color:#555;margin:0 5px}.quantity-label[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;color:#555}ion-button[_ngcontent-%COMP%]{--border-radius: 8px;--padding-start: 8px;--padding-end: 8px}.qty-btn[_ngcontent-%COMP%]{color:#88ac8c!important;--border-color: rgb(136, 172, 140) !important;--ion-color-primary: rgb(136, 172, 140) !important;--ion-color-primary-rgb: 136, 172, 140 !important;--padding-top:0px !important;--padding-bottom:0px !important}.trash-container[_ngcontent-%COMP%]{position:absolute;top:5px;right:5px;z-index:10}.trash-icon[_ngcontent-%COMP%]{color:#bf6c07;font-size:1.2rem}.discount-card[_ngcontent-%COMP%], .delivery-card[_ngcontent-%COMP%]{padding:10px;text-align:center}.empty-cart[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:70vh;text-align:center}.empty-icon[_ngcontent-%COMP%]{font-size:4rem;color:#ccc;margin-bottom:10px}.product-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:8px}.product-info[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0}.product-info[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{margin-right:16px;width:80px;height:80px;border-radius:8px;overflow:hidden}.unit-price[_ngcontent-%COMP%]{font-size:.9rem;color:var(--ion-color-medium);margin:4px 0}.price-note[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;font-size:.8rem;color:#bf6c07;margin-left:8px}.price-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.quantity-section[_ngcontent-%COMP%]{justify-content:flex-start;margin-top:8px;--padding-start: 0;--inner-padding-end: 0}.qty-btn[_ngcontent-%COMP%]{height:32px}.qty-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.2rem}.item-price[_ngcontent-%COMP%]{margin-top:4px;display:flex;align-items:center}.trash-container[_ngcontent-%COMP%]{top:8px;right:8px}"]});let a=c;return a})();export{qt as CartComponent};
