import{a as ot,b as at}from"./chunk-U74BFMQT.js";import{a as et,x as it}from"./chunk-2E2WOBKK.js";import{A as $,B as q,O as J,P as K,U as Q,W as X,c as j,ca as Y,f as G,fa as Z,g as N,ga as tt,p as U,v as H,x as V}from"./chunk-B7BKEKPT.js";import"./chunk-EKYO6VDW.js";import"./chunk-24IHF5HR.js";import"./chunk-KFDLIPX5.js";import"./chunk-EPJFQAWK.js";import"./chunk-4UA7XWWY.js";import"./chunk-3P4LCZSC.js";import"./chunk-QB2INVK3.js";import"./chunk-T4NRX6V6.js";import"./chunk-R2OJ64UA.js";import"./chunk-RPLHLNGJ.js";import"./chunk-JZD5S6T4.js";import"./chunk-G223UPOJ.js";import"./chunk-ZSV5V4UX.js";import"./chunk-6AR4DOND.js";import"./chunk-67J5UTTO.js";import"./chunk-3QTGG56W.js";import"./chunk-SACCBILY.js";import"./chunk-GYT6Z5WN.js";import{Hb as L,I as c,J as m,Ja as W,Jb as z,M as S,Q as _,Sa as E,T as d,Tb as R,Va as F,Wa as A,Wb as B,Y as s,Z as r,_ as b,d as I,da as g,h as w,j as T,n as x,p as D,pa as p,ra as P,va as O,wa as k,xa as v}from"./chunk-YS7BCJTD.js";import"./chunk-5BIRNKZZ.js";import"./chunk-PN5KWPLT.js";import"./chunk-ZPEM7JC5.js";import"./chunk-AQXWH6LN.js";import"./chunk-XFZJ45JG.js";import"./chunk-QYFRFJTZ.js";import"./chunk-MN6QQCMN.js";import"./chunk-TP642E63.js";import"./chunk-SRRF7I6H.js";import{a as f,b as M,h as C}from"./chunk-LNJ3S2LQ.js";var lt="http://127.0.0.1:3000",nt=(()=>{let o=class o{constructor(t){this.http=t}getWholesellerPriceComparison(t){let i=new F().set("product_ids",t.join(","));return this.http.get(`${lt}/getWholesellerPriceComparison`,{params:i})}};o.\u0275fac=function(i){return new(i||o)(D(A))},o.\u0275prov=x({token:o,factory:o.\u0275fac,providedIn:"root"});let a=o;return a})();function pt(a,o){if(a&1&&(s(0,"ion-select-option",8),p(1),r()),a&2){let h=o.$implicit;d("value",h),c(),P(" ",h," ")}}function dt(a,o){if(a&1&&(s(0,"ion-select-option",8),p(1),r()),a&2){let h=o.$implicit;d("value",h),c(),P(" ",h," ")}}var yt=(()=>{let o=class o{constructor(t,i,e,l){this.navController=t,this.marketComparisonService=i,this.loadingController=e,this.toastController=l,this.availableMandis=["Azadpur Mandi","Ghazipur Mandi","Okhla Mandi"],this.availableProducts=["Potato","Onion","Tomato","Cauliflower","Green Peas","Cabbage"],this.selectedMandis=["Azadpur Mandi"],this.selectedProducts=["Potato","Onion","Tomato"],this.isLoading=!1,this.useRealData=!0,this.priceData={"Azadpur Mandi":{Potato:45,Onion:52,Tomato:38,Cauliflower:24,"Green Peas":33,Cabbage:26},"Ghazipur Mandi":{Potato:42,Onion:48,Tomato:35,Cauliflower:22,"Green Peas":31,Cabbage:24},"Okhla Mandi":{Potato:48,Onion:55,Tomato:42,Cauliflower:28,"Green Peas":36,Cabbage:29}},et({chevronBackOutline:it})}ngOnInit(){this.initializeCharts()}showLoading(){return C(this,null,function*(){this.isLoading=!0;let t=yield this.loadingController.create({message:"Loading price data...",spinner:"crescent"});return yield t.present(),t})}showToast(t){return C(this,null,function*(){yield(yield this.toastController.create({message:t,duration:3e3,position:"bottom",color:"warning",buttons:[{icon:"close",role:"cancel"}]})).present()})}goToTrends(){this.navController.navigateBack("/wholesaler/trends")}onMandiChange(t){this.selectedMandis.length&&this.selectedProducts.length&&(this.useRealData=!0,this.updateChart())}onProductChange(t){this.selectedMandis.length&&this.selectedProducts.length&&(this.useRealData=!0,this.updateChart())}updateChart(){return C(this,null,function*(){if(this.useRealData){let t=yield this.showLoading();try{let i=this.selectedProducts.map(e=>this.getProductId(e));this.marketComparisonService.getWholesellerPriceComparison(i).pipe(w(e=>(console.error("API Error:",e),this.showToast("Unable to fetch real-time data. Using stored data."),this.useRealData=!1,I(null))),T(()=>{t.dismiss(),this.isLoading=!1})).subscribe(e=>{e?this.updateChartWithRealData(e):(this.useRealData=!1,this.updateChartWithFallbackData())})}catch{t.dismiss(),this.isLoading=!1,this.useRealData=!1,this.updateChartWithFallbackData()}}else this.updateChartWithFallbackData()})}updateChartWithRealData(t){let i=Array.isArray(t)?t:[t],e=this.selectedMandis.map(l=>({name:l,data:this.selectedProducts.map(n=>{let y=i.find(u=>u.product_name===n);if(y){let u=y.prices.find(rt=>rt.wholeseller_id===this.getMandiId(l));return u?u.price_per_kg:0}return 0})}));this.updateChartOptions(e)}updateChartWithFallbackData(){let t=this.selectedMandis.map(i=>({name:i,data:this.selectedProducts.map(e=>this.priceData[i][e])}));this.updateChartOptions(t)}updateChartOptions(t){this.priceComparisonOptions=M(f({},this.priceComparisonOptions),{series:t,xaxis:M(f({},this.priceComparisonOptions.xaxis),{categories:this.selectedProducts})})}initializeCharts(){this.setupChartOptions(),this.updateChart()}setupChartOptions(){this.priceComparisonOptions={series:[],chart:{type:"bar",height:350,stacked:!1,toolbar:{show:!1}},plotOptions:{bar:{horizontal:!1,columnWidth:"55%",borderRadius:5}},colors:["#008FFB","#00E396","#FEB019"],xaxis:{categories:this.selectedProducts,title:{text:"Products"}},yaxis:{title:{text:"Price (\u20B9/kg)"},labels:{formatter:t=>`\u20B9${t}`}},tooltip:{y:{formatter:t=>`\u20B9${t}/kg`}}}}getProductId(t){return{Potato:1,Onion:2,Tomato:3,Cauliflower:4,"Green Peas":5,Cabbage:6}[t]||0}getMandiId(t){return{"Azadpur Mandi":1,"Ghazipur Mandi":2,"Okhla Mandi":3}[t]||0}};o.\u0275fac=function(i){return new(i||o)(m(B),m(nt),m(Y),m(Z))},o.\u0275cmp=S({type:o,selectors:[["app-market-comparison"]],decls:23,vars:11,consts:[["slot","start"],["color","dark",3,"click"],["name","chevron-back-outline"],[1,"filters-container"],["multiple","true",3,"ngModelChange","ionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"chart-container"],[3,"series","chart","xaxis","yaxis","plotOptions","colors","tooltip"],[3,"value"]],template:function(i,e){i&1&&(s(0,"ion-content")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),g("click",function(){return e.goToTrends()}),b(4,"ion-icon",2),r()(),s(5,"ion-title"),p(6,"Trends"),r()(),s(7,"div",3)(8,"ion-list")(9,"ion-item")(10,"ion-label"),p(11,"Select Mandis"),r(),s(12,"ion-select",4),v("ngModelChange",function(n){return k(e.selectedMandis,n)||(e.selectedMandis=n),n}),g("ionChange",function(n){return e.onMandiChange(n)}),_(13,pt,2,2,"ion-select-option",5),r()(),s(14,"ion-item")(15,"ion-label"),p(16,"Select Products"),r(),s(17,"ion-select",4),v("ngModelChange",function(n){return k(e.selectedProducts,n)||(e.selectedProducts=n),n}),g("ionChange",function(n){return e.onProductChange(n)}),_(18,dt,2,2,"ion-select-option",5),r()()()(),s(19,"div",6)(20,"h3"),p(21,"Price Comparison Across Markets"),r(),b(22,"apx-chart",7),r()()),i&2&&(c(12),O("ngModel",e.selectedMandis),c(),d("ngForOf",e.availableMandis),c(4),O("ngModel",e.selectedProducts),c(),d("ngForOf",e.availableProducts),c(4),d("series",e.priceComparisonOptions.series)("chart",e.priceComparisonOptions.chart)("xaxis",e.priceComparisonOptions.xaxis)("yaxis",e.priceComparisonOptions.yaxis)("plotOptions",e.priceComparisonOptions.plotOptions)("colors",e.priceComparisonOptions.colors)("tooltip",e.priceComparisonOptions.tooltip))},dependencies:[tt,G,N,U,H,V,$,q,J,K,Q,X,j,at,ot,R,L,z,E,W],styles:["[_nghost-%COMP%]{display:block;height:100%}.chart-container[_ngcontent-%COMP%]{width:100%;height:100%;padding:20px;background:#fff;border-radius:10px;box-shadow:0 2px 10px #0000001a}h3[_ngcontent-%COMP%]{color:#333;margin-bottom:20px;text-align:center}.filters-container[_ngcontent-%COMP%]{padding:16px;background:#fff;margin-bottom:16px}"]});let a=o;return a})();export{yt as MarketComparisonComponent};
