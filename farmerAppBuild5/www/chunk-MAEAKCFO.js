import{$ as B,A as W,S as j,b as w,d as E,ea as L,f as M,fa as q,h as k,i as x,j as P,l as R,p as F,w as A,x as N}from"./chunk-I3X6JMJK.js";import"./chunk-EKYO6VDW.js";import"./chunk-24IHF5HR.js";import"./chunk-KFDLIPX5.js";import"./chunk-EPJFQAWK.js";import"./chunk-4UA7XWWY.js";import"./chunk-3P4LCZSC.js";import"./chunk-QB2INVK3.js";import"./chunk-T4NRX6V6.js";import"./chunk-R2OJ64UA.js";import"./chunk-RPLHLNGJ.js";import"./chunk-JZD5S6T4.js";import"./chunk-G223UPOJ.js";import"./chunk-ZSV5V4UX.js";import"./chunk-6AR4DOND.js";import"./chunk-67J5UTTO.js";import"./chunk-3QTGG56W.js";import"./chunk-SACCBILY.js";import"./chunk-GYT6Z5WN.js";import{$a as T,I as m,Ib as v,J as c,Kb as O,M as D,Sb as I,T as y,Ta as b,Ub as S,Xa as _,Z as e,_ as i,ea as p,pa as n,ra as h,va as C,wa as g,xa as f}from"./chunk-MADRYJFV.js";import"./chunk-5BIRNKZZ.js";import"./chunk-PN5KWPLT.js";import"./chunk-ZPEM7JC5.js";import"./chunk-AQXWH6LN.js";import"./chunk-XFZJ45JG.js";import"./chunk-QYFRFJTZ.js";import"./chunk-MN6QQCMN.js";import"./chunk-TP642E63.js";import"./chunk-SRRF7I6H.js";import{h as l}from"./chunk-LNJ3S2LQ.js";var Z=(()=>{let d=class d{constructor(r,o,t,s){this.route=r,this.http=o,this.alertCtrl=t,this.toastCtrl=s,this.orderId="",this.otp="",this.notes="",this.otpTimer=30,this.isOtpResendDisabled=!0,this.otpSent=!1,this.phoneNumber="",this.apiUrl="http://127.0.0.1:3000/api"}ngOnInit(){this.orderId=this.route.snapshot.paramMap.get("id")||"Unknown",this.getOrderDetails()}ngOnDestroy(){clearInterval(this.timerInterval)}getOrderDetails(){this.http.get(`${this.apiUrl}/orders/${this.orderId}`).subscribe({next:r=>{this.phoneNumber=r.customerPhone},error:()=>{console.error("Failed to fetch order details.")}})}sendOtpToCustomer(){return l(this,null,function*(){this.otpSent||this.http.get(`${this.apiUrl}/send-otp?phone=${this.phoneNumber}`).subscribe({next:()=>l(this,null,function*(){this.otpSent=!0,this.otpTimer=30,this.isOtpResendDisabled=!0,this.startOtpTimer(),yield(yield this.toastCtrl.create({message:"OTP Sent to Customer!",duration:2e3,color:"primary"})).present()}),error:()=>l(this,null,function*(){yield(yield this.alertCtrl.create({header:"Error",message:"Failed to send OTP. Try again!",buttons:["OK"]})).present()})})})}startOtpTimer(){this.timerInterval=setInterval(()=>{this.otpTimer>0?this.otpTimer--:(this.isOtpResendDisabled=!1,this.otpSent=!1,clearInterval(this.timerInterval))},1e3)}resendOtp(){return l(this,null,function*(){if(this.otpTimer>0)return;this.otpTimer=30,this.isOtpResendDisabled=!0,this.startOtpTimer(),yield(yield this.toastCtrl.create({message:"OTP Resent Successfully!",duration:2e3,color:"primary"})).present(),this.sendOtpToCustomer()})}submitDelivery(){return l(this,null,function*(){if(!this.otp||this.otp.length!==4){yield(yield this.alertCtrl.create({header:"Error",message:"Please enter a valid 4-digit OTP.",buttons:["OK"]})).present();return}yield(yield this.toastCtrl.create({message:"Delivery Confirmed Successfully!",duration:2e3,color:"success"})).present()})}requestFeedback(){return l(this,null,function*(){yield(yield this.toastCtrl.create({message:"Feedback request sent to customer!",duration:2e3,color:"tertiary"})).present()})}};d.\u0275fac=function(o){return new(o||d)(c(T),c(_),c(B),c(L))},d.\u0275cmp=D({type:d,selectors:[["app-delivery-confirmation"]],decls:35,vars:5,consts:[[1,"ion-padding"],[1,"center-button"],[1,"custom-button",3,"click","disabled"],["position","stacked"],["type","number","maxlength","4",3,"ngModelChange","ngModel"],[1,"resend-otp",3,"click"],[3,"ngModelChange","ngModel"],[1,"custom-button",3,"click"]],template:function(o,t){o&1&&(e(0,"ion-content",0)(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),n(4,"\u{1F4E6} Order ID: #123456"),i()(),e(5,"ion-card-content")(6,"p"),n(7,"\u{1F3EA} "),e(8,"strong"),n(9,"Retailer:"),i(),n(10," ABC Supermarket"),i(),e(11,"p"),n(12,"\u{1F4CD} "),e(13,"strong"),n(14,"Delivery Location:"),i(),n(15," XYZ City, Street 10"),i()()(),e(16,"div",1)(17,"ion-button",2),p("click",function(){return t.sendOtpToCustomer()}),n(18),i()(),e(19,"ion-item")(20,"ion-label",3),n(21,"\u{1F522} Enter OTP"),i(),e(22,"ion-input",4),f("ngModelChange",function(a){return g(t.otp,a)||(t.otp=a),a}),i()(),e(23,"p",5),p("click",function(){return t.resendOtp()}),n(24),i(),e(25,"ion-item")(26,"ion-label",3),n(27,"\u{1F4DC} Additional Notes (Optional)"),i(),e(28,"ion-textarea",6),f("ngModelChange",function(a){return g(t.notes,a)||(t.notes=a),a}),i()(),e(29,"div",1)(30,"ion-button",7),p("click",function(){return t.submitDelivery()}),n(31," \u{1F4EE} Submit Delivery Report "),i()(),e(32,"div",1)(33,"ion-button",7),p("click",function(){return t.requestFeedback()}),n(34," \u2B50 Request Customer Feedback "),i()()()),o&2&&(m(17),y("disabled",t.otpSent),m(),h(" \u{1F4E9} ",t.otpSent?"OTP Sent to Customer":"Send OTP to Customer"," "),m(4),C("ngModel",t.otp),m(2),h("Resend OTP in ",t.otpTimer,"s"),m(4),C("ngModel",t.notes))},dependencies:[q,M,k,x,P,R,F,A,N,W,j,w,E,S,v,I,O,b],styles:["ion-card-title[_ngcontent-%COMP%]{font-size:medium}.center-button[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.custom-button[_ngcontent-%COMP%]{font-family:Georgia,Times,serif;--background: rgb(136, 172, 140);--color: white;--border-radius: 8px;--box-shadow: 0 4px 6px rgba(0, 0, 0, .1);font-size:.8rem}"]});let u=d;return u})();export{Z as DeliveryConfirmationComponent};
