import{a as ae,b as re}from"./chunk-KVOL7TGB.js";import{D as ne,a as ie}from"./chunk-JT32FGMS.js";import{A as Q,M as U,N as J,O as H,P as X,T as Z,V as ee,ba as te,c as q,f as Y,fa as oe,g as K,p as G,v as N}from"./chunk-I3X6JMJK.js";import"./chunk-EKYO6VDW.js";import"./chunk-24IHF5HR.js";import"./chunk-KFDLIPX5.js";import"./chunk-EPJFQAWK.js";import"./chunk-4UA7XWWY.js";import"./chunk-3P4LCZSC.js";import"./chunk-QB2INVK3.js";import"./chunk-T4NRX6V6.js";import"./chunk-R2OJ64UA.js";import"./chunk-RPLHLNGJ.js";import"./chunk-JZD5S6T4.js";import"./chunk-G223UPOJ.js";import"./chunk-ZSV5V4UX.js";import"./chunk-6AR4DOND.js";import"./chunk-67J5UTTO.js";import"./chunk-3QTGG56W.js";import"./chunk-SACCBILY.js";import"./chunk-GYT6Z5WN.js";import{$ as x,I as u,Ib as R,J as _,Kb as W,La as E,M as V,Q as f,T as h,Ta as $,Ub as A,Xa as z,Xb as j,Z as c,_ as d,aa as O,ba as F,d as v,da as L,ea as y,fa as g,h as P,j as M,n as B,p as I,pa as p,u as w,v as k,va as S,wa as T,xa as b}from"./chunk-MADRYJFV.js";import"./chunk-5BIRNKZZ.js";import"./chunk-PN5KWPLT.js";import"./chunk-ZPEM7JC5.js";import"./chunk-AQXWH6LN.js";import"./chunk-XFZJ45JG.js";import"./chunk-QYFRFJTZ.js";import"./chunk-MN6QQCMN.js";import"./chunk-TP642E63.js";import"./chunk-SRRF7I6H.js";import{h as C}from"./chunk-LNJ3S2LQ.js";var m="http://127.0.0.1:3000",se=(()=>{let s=class s{constructor(o){this.http=o}getMonthlySales(){return this.http.get(`${m}/getSalesValue/monthly`)}getWeeklySales(){return this.http.get(`${m}/getSalesValue/weekly`)}getYearlySales(){return this.http.get(`${m}/getSalesValue/yearly`)}getTopSellingDaily(){return this.http.get(`${m}/getTopSellingDaily`)}getTopSellingWeekly(){return this.http.get(`${m}/getTopSellingWeekly`)}getTopSellingMonthly(){return this.http.get(`${m}/getTopSellingMonthly`)}getTopSellingYearly(){return this.http.get(`${m}/getTopSellingYearly`)}};s.\u0275fac=function(e){return new(e||s)(I(z))},s.\u0275prov=B({token:s,factory:s.\u0275fac,providedIn:"root"});let r=s;return r})();function de(r,s){if(r&1){let n=L();c(0,"ion-select",15),b("ngModelChange",function(e){w(n);let t=g();return T(t.selectedMetric,e)||(t.selectedMetric=e),k(e)}),y("ionChange",function(){w(n);let e=g();return k(e.onMetricChange())}),c(1,"ion-select-option",16),p(2,"By Volume (kg)"),d(),c(3,"ion-select-option",17),p(4,"By Revenue (\u20B9)"),d()()}if(r&2){let n=g();S("ngModel",n.selectedMetric)}}function pe(r,s){if(r&1&&x(0,"apx-chart",19),r&2){let n=g(2);h("series",n.chartOptions.series)("chart",n.chartOptions.chart)("xaxis",n.chartOptions.xaxis)("yaxis",n.chartOptions.yaxis)("colors",n.chartOptions.colors)("title",n.chartOptions.title)}}function ue(r,s){if(r&1&&(O(0),f(1,pe,1,6,"apx-chart",18),F()),r&2){let n=g();u(),h("ngIf",n.chartOptions==null?null:n.chartOptions.series)}}function he(r,s){if(r&1&&x(0,"apx-chart",21),r&2){let n=g(2);h("series",n.topProductsOptions.series)("chart",n.topProductsOptions.chart)("xaxis",n.topProductsOptions.xaxis)("yaxis",n.topProductsOptions.yaxis)("plotOptions",n.topProductsOptions.plotOptions)("dataLabels",n.topProductsOptions.dataLabels)("colors",n.topProductsOptions.colors)("title",n.topProductsOptions.title)("grid",n.topProductsOptions.grid)("tooltip",n.topProductsOptions.tooltip)}}function ge(r,s){if(r&1&&(O(0),f(1,he,1,10,"apx-chart",20),F()),r&2){let n=g();u(),h("ngIf",n.topProductsOptions==null?null:n.topProductsOptions.series)}}var we=(()=>{let s=class s{constructor(o,e,t){this.navController=o,this.salesTrendsService=e,this.loadingController=t,this.selectedView="trends",this.selectedPeriod="monthly",this.selectedMetric="volume",this.useRealData=!0,this.isLoading=!1,this.errorMessage="",ie({chevronBackOutline:ne})}ngOnInit(){this.selectedView="trends",this.selectedPeriod="monthly",this.selectedMetric="volume",setTimeout(()=>{this.initializeCharts()},0)}showLoading(){return C(this,null,function*(){this.isLoading=!0;let o=yield this.loadingController.create({message:"Loading data...",spinner:"crescent"});return yield o.present(),o})}goToTrends(){this.navController.navigateBack("/wholesaler/trends")}onViewChange(){this.selectedView==="trends"?this.updateTrendsChart():this.updateTopProductsChart()}onPeriodChange(){this.selectedView==="trends"?(this.useRealData=!0,this.updateTrendsChart()):this.updateTopProductsChart()}onMetricChange(){this.selectedView==="products"&&this.updateTopProductsChart()}toggleDataSource(){this.useRealData=!this.useRealData,this.errorMessage="",this.initializeCharts()}initializeCharts(){this.updateTrendsChart(),this.updateTopProductsChart()}updateTrendsChart(){return C(this,null,function*(){if(!this.useRealData){let e=this.getDataForPeriod(this.selectedPeriod);this.updateTrendsChartOptions(e.values.map((t,l)=>({date:e.categories[l],total_sales:t})));return}let o=yield this.showLoading();try{let e;switch(this.selectedPeriod){case"weekly":e=this.salesTrendsService.getWeeklySales();break;case"monthly":e=this.salesTrendsService.getMonthlySales();break;case"yearly":e=this.salesTrendsService.getYearlySales();break;default:e=this.salesTrendsService.getMonthlySales()}e.pipe(P(t=>{this.errorMessage="Failed to fetch real data. Falling back to dummy data.",this.useRealData=!1;let l=this.getDataForPeriod(this.selectedPeriod);return v(l.values.map((i,a)=>({date:l.categories[a],total_sales:i})))}),M(()=>{o.dismiss(),this.isLoading=!1})).subscribe({next:t=>{console.log("Fetched data:",t),t&&Array.isArray(t)&&this.updateTrendsChartOptions(t)},error:t=>{console.error("Error updating trends chart:",t)}})}catch(e){o.dismiss(),this.isLoading=!1,console.error("Error in updateTrendsChart:",e)}})}updateTrendsChartOptions(o){this.chartOptions={series:[{name:"Total Revenue",data:o.map(e=>e.total_revenue)},{name:"Total Orders",data:o.map(e=>e.total_orders)}],chart:{height:350,type:"line",background:"#ffffff",toolbar:{show:!0}},colors:["#2E93fA","#66DA26"],xaxis:{categories:o.map(e=>e.month_year)},yaxis:[{title:{text:"Revenue (\u20B9)"},labels:{formatter:e=>`\u20B9${(e/1e3).toFixed(0)}K`}},{opposite:!0,title:{text:"Orders"},labels:{formatter:e=>`${Math.round(e)}`}}],title:{text:`${this.capitalize(this.selectedPeriod)} Sales Trends`,align:"center",style:{fontSize:"16px"},margin:40}}}updateTopProductsChart(){return C(this,null,function*(){let o;if(this.useRealData){o=yield this.showLoading();let e;switch(this.selectedPeriod){case"daily":e=this.salesTrendsService.getTopSellingDaily();break;case"weekly":e=this.salesTrendsService.getTopSellingWeekly();break;case"monthly":e=this.salesTrendsService.getTopSellingMonthly();break;case"yearly":e=this.salesTrendsService.getTopSellingYearly();break;default:e=this.salesTrendsService.getTopSellingMonthly()}e.pipe(P(t=>(this.errorMessage="Failed to fetch top products data. Falling back to dummy data.",this.useRealData=!1,v(this.getTopProductsForPeriod(this.selectedPeriod).map(l=>({product_id:0,product_name:l.name,mandi_id:0,mandi_name:null,unit_id:1,quantity:l.volume,price:l.price,total_quantity_kg:l.volume,actual_delivery_date:new Date().toISOString(),total_price:l.price}))))),M(()=>{o==null||o.dismiss(),this.isLoading=!1})).subscribe(t=>{this.updateTopProductsChartOptions(t)})}else{let e=this.getTopProductsForPeriod(this.selectedPeriod),t=this.selectedMetric==="volume",l=e.map(a=>t?a.volume:a.price),i=[...e].sort((a,D)=>t?D.volume-a.volume:D.price-a.price);this.topProductsOptions={series:[{name:t?"Sales Volume":"Sales Revenue",data:i.map(a=>t?a.volume:a.price)}],chart:{type:"bar",height:450,background:"#ffffff",toolbar:{show:!1},animations:{enabled:!0},foreColor:"#333",fontFamily:"inherit"},grid:{padding:{bottom:70},xaxis:{lines:{show:!0}}},plotOptions:{bar:{horizontal:!1,borderRadius:4,columnWidth:"60%"}},dataLabels:{enabled:!0,formatter:a=>t?`${a}kg`:`\u20B9${(a/1e3).toFixed(0)}K`,style:{fontSize:"7px",colors:["#000"]}},xaxis:{categories:i.map(a=>a.name),title:{text:"Products & Mandi Location",offsetY:70,style:{fontSize:"14px"},floating:!1},labels:{rotate:-90,style:{fontSize:"11px"}}},yaxis:{title:{text:t?"Sales Volume (kg)":"Sales Revenue (\u20B9)"},labels:{formatter:a=>t?`${a} kg`:`\u20B9${(a/1e3).toFixed(0)}K`}},colors:["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEEAD","#FFD93D","#6C5B7B","#355C7D","#F67280","#2A363B"],title:{text:`Top Products by ${t?"Volume":"Revenue"} - ${this.capitalize(this.selectedPeriod)}`,align:"center",style:{fontSize:"16px"},margin:20},tooltip:{y:{formatter:a=>t?`${a} kg`:`\u20B9${a.toLocaleString()}`}}}}})}updateTopProductsChartOptions(o){let e=this.selectedMetric==="volume";console.log("Top Products:",o);let l=[...o].sort((i,a)=>e?(a.total_quantity_kg||0)-(i.total_quantity_kg||0):(a.total_price||0)-(i.total_price||0)).slice(0,10);this.topProductsOptions={series:[{name:e?"Sales Volume (kg)":"Sales Revenue (\u20B9)",data:l.map(i=>e?i.total_quantity_kg:i.total_price)}],chart:{type:"bar",height:450,background:"#ffffff",toolbar:{show:!1},animations:{enabled:!0},foreColor:"#333",fontFamily:"inherit"},grid:{padding:{bottom:70},xaxis:{lines:{show:!0}}},plotOptions:{bar:{horizontal:!1,borderRadius:4,columnWidth:"60%"}},dataLabels:{enabled:!0,formatter:i=>e?`${i}kg`:`\u20B9${(i/1e3).toFixed(0)}K`,style:{fontSize:"7px",colors:["#000"]}},xaxis:{categories:l.map(i=>`${i.product_name||"Unknown"} (${i.mandi_name||"Unknown Mandi"})`),title:{text:"Products",offsetY:70,style:{fontSize:"14px"},floating:!1},labels:{rotate:-90,style:{fontSize:"11px"}}},yaxis:{title:{text:e?"Sales Volume (kg)":"Revenue (\u20B9)"},labels:{formatter:i=>e?`${i==null?void 0:i.toFixed(2)} kg`:`\u20B9${(i/1e3).toFixed(0)}K`}},colors:["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEEAD","#FFD93D","#6C5B7B","#355C7D","#F67280","#2A363B"],title:{text:`Top Products by ${e?"Volume":"Revenue"} - ${this.capitalize(this.selectedPeriod)}`,align:"center",style:{fontSize:"16px"},margin:20},tooltip:{y:{formatter:i=>e?`${i} kg`:`\u20B9${i.toLocaleString()}`}}}}getTopProductsForPeriod(o){let e={weekly:1e3,monthly:4e3,quarterly:12e3,yearly:5e4}[o]||1e3,t={Onion:20,Potato:15,Tomato:25,Cabbage:12,Cauliflower:30,"Green Peas":40,Carrot:18,"Bitter Gourd":35,"Lady Finger":22,Brinjal:16};return[{name:"Onion (Lasalgaon Mandi)",volume:e+500,price:(e+500)*t.Onion},{name:"Potato (Agra Mandi)",volume:e+300,price:(e+300)*t.Potato},{name:"Tomato (Kolar Mandi)",volume:e+200,price:(e+200)*t.Tomato},{name:"Cabbage (Pune Mandi)",volume:e-100,price:(e-100)*t.Cabbage},{name:"Cauliflower (Delhi Mandi)",volume:e-300,price:(e-300)*t.Cauliflower},{name:"Green Peas (Indore Mandi)",volume:e-500,price:(e-500)*t["Green Peas"]},{name:"Carrot (Bangalore Mandi)",volume:e-800,price:(e-800)*t.Carrot},{name:"Bitter Gourd (Chennai Mandi)",volume:e-900,price:(e-900)*t["Bitter Gourd"]},{name:"Lady Finger (Ahmedabad Mandi)",volume:e-1e3,price:(e-1e3)*t["Lady Finger"]},{name:"Brinjal (Kolkata Mandi)",volume:e-1200,price:(e-1200)*t.Brinjal}]}getDataForPeriod(o){switch(o){case"weekly":return{categories:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],values:[42e3,38e3,45e3,5e4,49e3,6e4,55e3]};case"monthly":return{categories:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],values:[32e4,45e4,38e4,54e4,42e4,68e4,72e4,85e4,69e4,92e4,85e4,99e4]};case"quarterly":return{categories:["Q1","Q2","Q3","Q4"],values:[115e4,164e4,226e4,276e4]};case"yearly":return{categories:["2020","2021","2022","2023","2024"],values:[58e5,65e5,78e5,89e5,95e5]};default:return{categories:[],values:[]}}}capitalize(o){return o.charAt(0).toUpperCase()+o.slice(1)}};s.\u0275fac=function(e){return new(e||s)(_(j),_(se),_(te))},s.\u0275cmp=V({type:s,selectors:[["app-sales-trends"]],decls:28,vars:5,consts:[["slot","start"],["color","dark",3,"click"],["name","chevron-back-outline"],[1,"controls-container"],["mode","ios",3,"ngModelChange","ionChange","ngModel"],["value","trends"],["value","products"],["interface","popover","label","Select Period",1,"period-selector",3,"ngModelChange","ionChange","ngModel"],["value","weekly"],["value","monthly"],["value","quarterly"],["value","yearly"],["interface","popover","class","period-selector metric-selector","label","View By",3,"ngModel","ngModelChange","ionChange",4,"ngIf"],[1,"chart-container"],[4,"ngIf"],["interface","popover","label","View By",1,"period-selector","metric-selector",3,"ngModelChange","ionChange","ngModel"],["value","volume"],["value","price"],[3,"series","chart","xaxis","yaxis","colors","title",4,"ngIf"],[3,"series","chart","xaxis","yaxis","colors","title"],[3,"series","chart","xaxis","yaxis","plotOptions","dataLabels","colors","title","grid","tooltip",4,"ngIf"],[3,"series","chart","xaxis","yaxis","plotOptions","dataLabels","colors","title","grid","tooltip"]],template:function(e,t){e&1&&(c(0,"ion-content")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),y("click",function(){return t.goToTrends()}),x(4,"ion-icon",2),d()(),c(5,"ion-title"),p(6,"Trends"),d()(),c(7,"div",3)(8,"ion-segment",4),b("ngModelChange",function(i){return T(t.selectedView,i)||(t.selectedView=i),i}),y("ionChange",function(){return t.onViewChange()}),c(9,"ion-segment-button",5)(10,"ion-label"),p(11,"Sales Trends"),d()(),c(12,"ion-segment-button",6)(13,"ion-label"),p(14,"Top Products"),d()()(),c(15,"ion-select",7),b("ngModelChange",function(i){return T(t.selectedPeriod,i)||(t.selectedPeriod=i),i}),y("ionChange",function(){return t.onPeriodChange()}),c(16,"ion-select-option",8),p(17,"Weekly"),d(),c(18,"ion-select-option",9),p(19,"Monthly"),d(),c(20,"ion-select-option",10),p(21,"Quarterly"),d(),c(22,"ion-select-option",11),p(23,"Yearly"),d()(),f(24,de,5,1,"ion-select",12),d(),c(25,"div",13),f(26,ue,2,1,"ng-container",14)(27,ge,2,1,"ng-container",14),d()()),e&2&&(u(8),S("ngModel",t.selectedView),u(7),S("ngModel",t.selectedPeriod),u(9),h("ngIf",t.selectedView==="products"),u(2),h("ngIf",t.selectedView==="trends"),u(),h("ngIf",t.selectedView==="products"))},dependencies:[oe,Y,K,G,N,Q,U,J,H,X,Z,ee,q,re,ae,A,R,W,$,E],styles:["[_nghost-%COMP%]{display:block;height:100%}.controls-container[_ngcontent-%COMP%]{padding:16px;background:#fff;position:sticky;top:0;z-index:100}.period-selector[_ngcontent-%COMP%]{margin-top:16px;width:100%;max-width:300px;--padding-start: 16px;--padding-end: 16px}.period-selector[_ngcontent-%COMP%] + .period-selector[_ngcontent-%COMP%]{margin-top:8px}.chart-container[_ngcontent-%COMP%]{width:100%;height:calc(100% - 120px);padding:20px;background:#fff;border-radius:10px;box-shadow:0 2px 10px #0000001a;margin-top:16px}"]});let r=s;return r})();export{we as SalesTrendsComponent};
