import{a as vt,b as xt}from"./chunk-KVOL7TGB.js";import{D as _t,N as Ct,Ta as Mt,Va as Ot,Ya as Pt,a as mt,ha as ut,p as pt}from"./chunk-JT32FGMS.js";import{A as nt,B as et,M as it,N as ot,O as st,P as at,Q as rt,T as ct,V as lt,ba as gt,c as J,ea as dt,f as K,fa as ht,g as Q,n as X,p as Y,v as Z,x as tt}from"./chunk-I3X6JMJK.js";import"./chunk-EKYO6VDW.js";import"./chunk-24IHF5HR.js";import"./chunk-KFDLIPX5.js";import"./chunk-EPJFQAWK.js";import"./chunk-4UA7XWWY.js";import"./chunk-3P4LCZSC.js";import"./chunk-QB2INVK3.js";import"./chunk-T4NRX6V6.js";import"./chunk-R2OJ64UA.js";import"./chunk-RPLHLNGJ.js";import"./chunk-JZD5S6T4.js";import"./chunk-G223UPOJ.js";import"./chunk-ZSV5V4UX.js";import"./chunk-6AR4DOND.js";import"./chunk-67J5UTTO.js";import"./chunk-3QTGG56W.js";import"./chunk-SACCBILY.js";import"./chunk-GYT6Z5WN.js";import{$ as d,Ba as P,Ca as v,I as r,Ib as R,J as M,Ka as B,Kb as U,La as D,M as A,Ma as V,Na as j,Q as m,Sa as N,T as l,Ta as $,Ub as q,Xa as H,Xb as G,Z as e,_ as s,da as z,ea as k,f as T,fa as C,j as x,n as F,p as W,pa as c,qa as O,ra as p,u as w,v as S,va as b,wa as y,xa as I}from"./chunk-MADRYJFV.js";import"./chunk-5BIRNKZZ.js";import"./chunk-PN5KWPLT.js";import"./chunk-ZPEM7JC5.js";import"./chunk-AQXWH6LN.js";import"./chunk-XFZJ45JG.js";import"./chunk-QYFRFJTZ.js";import"./chunk-MN6QQCMN.js";import"./chunk-TP642E63.js";import"./chunk-SRRF7I6H.js";import{a as L,b as E,h}from"./chunk-LNJ3S2LQ.js";var u="http://127.0.0.1:3000",ft=(()=>{let a=class a{constructor(o){this.http=o}getCurrentStockByMandi(o){return this.http.get(`${u}/getCurrentStockByMandi/${o}`)}getLeastStockedProducts(){return this.http.get(`${u}/getMandiStockedProduct`)}getLowStockItems(){return this.http.get(`${u}/getLowStockItems`)}getStockAvailabilityPercentage(){return this.http.get(`${u}/getStockAvailabilityPercentage`)}getMandiList(){return this.http.get(`${u}/getMandiDetails`).pipe(T(o=>o.map(t=>({mandi_id:t.mandi_id,mandi_name:t.mandi_name}))))}getSlowMovingProducts(){return this.http.get(`${u}/getSlowMovingProducts`)}};a.\u0275fac=function(t){return new(t||a)(W(H))},a.\u0275prov=F({token:a,factory:a.\u0275fac,providedIn:"root"});let i=a;return i})();function kt(i,a){i&1&&(e(0,"div",11),d(1,"ion-spinner"),e(2,"p"),c(3,"Loading data..."),s()())}function bt(i,a){if(i&1&&(e(0,"ion-select-option",17),c(1),s()),i&2){let n=a.$implicit;l("value",n),r(),p(" ",n.mandi_name," ")}}function yt(i,a){if(i&1&&d(0,"apx-chart",18),i&2){let n=C(2);l("series",n.stockLevelsOptions.series)("chart",n.stockLevelsOptions.chart)("xaxis",n.stockLevelsOptions.xaxis)("yaxis",n.stockLevelsOptions.yaxis)("colors",n.stockLevelsOptions.colors)("plotOptions",n.stockLevelsOptions.plotOptions)("dataLabels",n.stockLevelsOptions.dataLabels)("tooltip",n.stockLevelsOptions.tooltip)}}function It(i,a){if(i&1){let n=z();e(0,"div",12)(1,"ion-item",13)(2,"ion-label"),c(3,"Select Warehouse/Mandi"),s(),e(4,"ion-select",14),I("ngModelChange",function(t){w(n);let g=C();return y(g.selectedWarehouse,t)||(g.selectedWarehouse=t),S(t)}),k("ionChange",function(){w(n);let t=C();return S(t.updateChartData())}),m(5,bt,2,2,"ion-select-option",15),s()(),e(6,"h3"),c(7),s(),m(8,yt,1,8,"apx-chart",16),s()}if(i&2){let n=C();r(4),b("ngModel",n.selectedWarehouse),r(),l("ngForOf",n.warehouses),r(2),p("Stock Levels - ",n.selectedWarehouse==null?null:n.selectedWarehouse.mandi_name,""),r(),l("ngIf",n.stockLevelsOptions)}}function Lt(i,a){if(i&1&&(e(0,"div",29)(1,"div",30),d(2,"ion-icon",31),e(3,"span"),c(4),s()(),e(5,"div",32)(6,"div",33)(7,"span",34),c(8,"Current Stock:"),s(),e(9,"span",35),c(10),P(11,"number"),s()()()()),i&2){let n=a.$implicit;r(4),O(n.mandi_name),r(6),p("",v(11,2,n.mandi_stock)," kg")}}function Et(i,a){if(i&1&&(e(0,"ion-item",24)(1,"ion-label")(2,"div",25)(3,"h3"),c(4),s(),e(5,"ion-chip",26)(6,"ion-label"),c(7),P(8,"number"),s()()(),e(9,"div",27),m(10,Lt,12,4,"div",28),s()()()),i&2){let n=a.$implicit;r(4),O(n.product_name),r(3),p("Total: ",v(8,3,n.current_stock)," kg"),r(3),l("ngForOf",n.mandis)}}function Tt(i,a){if(i&1&&(e(0,"div",19)(1,"div",20),d(2,"ion-icon",21),e(3,"h2"),c(4,"Low Stock Alerts"),s()(),e(5,"ion-list",22),m(6,Et,11,5,"ion-item",23),s()()),i&2){let n=C();r(6),l("ngForOf",n.lowStockAlerts)}}function Ft(i,a){if(i&1&&(e(0,"ion-item",38)(1,"ion-label")(2,"div",25)(3,"h3"),c(4),s(),e(5,"ion-chip",39)(6,"ion-label"),c(7),s()()(),e(8,"div",40)(9,"div",41),d(10,"ion-icon",42),e(11,"div",43)(12,"span",34),c(13,"Location"),s(),e(14,"span",35),c(15),s()()(),e(16,"div",41),d(17,"ion-icon",44),e(18,"div",43)(19,"span",34),c(20,"Current Stock"),s(),e(21,"span",35),c(22),P(23,"number"),s()()(),e(24,"div",41),d(25,"ion-icon",45),e(26,"div",43)(27,"span",34),c(28,"Weekly Sales"),s(),e(29,"span",35),c(30),P(31,"number"),s()()()()()()),i&2){let n=a.$implicit;r(4),O(n.product_name),r(),l("color",n.weekly_sales<n.stock_left*.1?"warning":"medium"),r(2),p("",n.days_in_stock," days in stock"),r(8),O(n.mandi_name),r(7),p("",v(23,6,n.stock_left)," kg"),r(8),p("",v(31,8,n.weekly_sales)," kg")}}function Wt(i,a){if(i&1&&(e(0,"div",19)(1,"div",20),d(2,"ion-icon",36),e(3,"h2"),c(4,"Slow Moving Products"),s()(),e(5,"ion-list",22),m(6,Ft,32,10,"ion-item",37),s()()),i&2){let n=C();r(6),l("ngForOf",n.slowMovingProducts)}}var Jt=(()=>{let a=class a{constructor(o,t,g,f){this.navController=o,this.stockInsightsService=t,this.loadingController=g,this.toastController=f,this.selectedView="chart",this.selectedWarehouse=null,this.slowMovingProducts=[],this.warehouses=[],this.stockLevelsOptions={series:[{name:"Current Stock",data:[]}],chart:{type:"bar",height:350,background:"#ffffff"},plotOptions:{bar:{horizontal:!0,barHeight:"50%",distributed:!0}},colors:["#33b2df","#546E7A","#d4526e","#13d8aa","#A5978B","#2b908f"],dataLabels:{enabled:!0,formatter:_=>_.toLocaleString()+" kg"},xaxis:{categories:[]},yaxis:{labels:{show:!0}},tooltip:{y:{formatter:_=>_.toLocaleString()+" kg"}}},this.lowStockAlerts=[],this.isLoading=!1,this.error=null,mt({warningOutline:Pt,timerOutline:Mt,businessOutline:pt,locationOutline:ut,cubeOutline:Ct,trendingDownOutline:Ot,chevronBackOutline:_t})}ngOnInit(){this.loadMandis()}loadMandis(){return h(this,null,function*(){this.isLoading=!0,this.error=null;let o=yield this.showLoading();try{this.stockInsightsService.getMandiList().subscribe({next:t=>{this.warehouses=t,t.length>0?(this.selectedWarehouse=t[0],this.initializeData()):this.error="No mandis available"},error:t=>{console.error("Failed to load mandis:",t),this.error="Failed to load mandi list. Please try again.",this.showErrorToast(this.error)},complete:()=>{o.dismiss(),this.isLoading=!1}})}catch{o.dismiss(),this.isLoading=!1,this.error="An unexpected error occurred",this.showErrorToast(this.error)}})}showErrorToast(o){return h(this,null,function*(){yield(yield this.toastController.create({message:o,duration:3e3,position:"bottom",color:"danger",buttons:[{icon:"close",role:"cancel"}]})).present()})}showLoading(){return h(this,null,function*(){this.isLoading=!0;let o=yield this.loadingController.create({message:"Loading data...",spinner:"crescent"});return yield o.present(),o})}goToTrends(){this.navController.navigateBack("/wholesaler/trends")}initializeData(){return h(this,null,function*(){yield this.initializeCharts(),yield this.initializeAlerts(),yield this.initializeSlowMoving()})}initializeCharts(){return h(this,null,function*(){yield this.updateChartData()})}initializeAlerts(){return h(this,null,function*(){let o=yield this.showLoading();try{this.stockInsightsService.getLowStockItems().pipe(x(()=>{o.dismiss(),this.isLoading=!1})).subscribe({next:t=>{this.lowStockAlerts=t},error:t=>{console.error("Failed to fetch low stock items:",t),this.showErrorToast("Failed to fetch low stock alerts")}})}catch{o.dismiss(),this.showErrorToast("An error occurred while fetching alerts")}})}initializeSlowMoving(){return h(this,null,function*(){let o=yield this.showLoading();try{this.stockInsightsService.getSlowMovingProducts().pipe(x(()=>{o.dismiss(),this.isLoading=!1})).subscribe({next:t=>{this.slowMovingProducts=t},error:t=>{console.error("Failed to fetch slow moving products:",t),this.showErrorToast("Failed to fetch slow moving products")}})}catch{o.dismiss(),this.showErrorToast("An error occurred while fetching slow moving products")}})}updateChartData(){return h(this,null,function*(){if(!this.selectedWarehouse)return;let o=yield this.showLoading();try{this.stockInsightsService.getCurrentStockByMandi(this.selectedWarehouse.mandi_id).pipe(x(()=>{o.dismiss(),this.isLoading=!1})).subscribe({next:t=>{this.updateChartWithData(t)},error:t=>{console.error("Failed to fetch stock data:",t),this.showErrorToast("Failed to fetch stock data")}})}catch{o.dismiss(),this.showErrorToast("An error occurred while fetching stock data")}})}updateChartWithData(o){this.stockLevelsOptions=E(L({},this.stockLevelsOptions),{series:[{name:"Current Stock",data:o.map(t=>t.current_stock)}],xaxis:{categories:o.map(t=>t.product_name)}})}};a.\u0275fac=function(t){return new(t||a)(M(G),M(ft),M(gt),M(dt))},a.\u0275cmp=A({type:a,selectors:[["app-stock-insights"]],decls:22,vars:6,consts:[["slot","start"],["color","dark",3,"click"],["name","chevron-back-outline"],["class","ion-text-center ion-padding",4,"ngIf"],["mode","ios",3,"ngModelChange","ngModel"],["value","chart"],["value","alerts"],["value","slow"],[3,"ngSwitch"],["class","chart-container",4,"ngSwitchCase"],["class","insights-container",4,"ngSwitchCase"],[1,"ion-text-center","ion-padding"],[1,"chart-container"],[1,"warehouse-select"],[3,"ngModelChange","ionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"series","chart","xaxis","yaxis","colors","plotOptions","dataLabels","tooltip",4,"ngIf"],[3,"value"],[3,"series","chart","xaxis","yaxis","colors","plotOptions","dataLabels","tooltip"],[1,"insights-container"],[1,"header-section"],["name","warning-outline","color","danger"],[1,"insights-list"],["class","insight-card low-stock",4,"ngFor","ngForOf"],[1,"insight-card","low-stock"],[1,"card-header"],["color","danger","outline","true"],[1,"locations-grid"],["class","location-card",4,"ngFor","ngForOf"],[1,"location-card"],[1,"location-header"],["name","business-outline"],[1,"stock-details"],[1,"stock-value"],[1,"label"],[1,"value"],["name","timer-outline","color","warning"],["class","insight-card slow-moving",4,"ngFor","ngForOf"],[1,"insight-card","slow-moving"],["outline","true",3,"color"],[1,"stats-grid"],[1,"stat-item"],["name","location-outline"],[1,"stat-details"],["name","cube-outline"],["name","trending-down-outline"]],template:function(t,g){t&1&&(e(0,"ion-content")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),k("click",function(){return g.goToTrends()}),d(4,"ion-icon",2),s()(),e(5,"ion-title"),c(6,"Trends"),s()(),m(7,kt,4,0,"div",3),e(8,"ion-segment",4),I("ngModelChange",function(_){return y(g.selectedView,_)||(g.selectedView=_),_}),e(9,"ion-segment-button",5)(10,"ion-label"),c(11,"Stock Levels"),s()(),e(12,"ion-segment-button",6)(13,"ion-label"),c(14,"Low Stock"),s()(),e(15,"ion-segment-button",7)(16,"ion-label"),c(17,"Slow Moving"),s()()(),e(18,"div",8),m(19,It,9,4,"div",9)(20,Tt,7,1,"div",10)(21,Wt,7,1,"div",10),s()()),t&2&&(r(7),l("ngIf",g.isLoading),r(),b("ngModel",g.selectedView),r(10),l("ngSwitch",g.selectedView),r(),l("ngSwitchCase","chart"),r(),l("ngSwitchCase","alerts"),r(),l("ngSwitchCase","slow"))},dependencies:[ht,K,Q,X,Y,Z,tt,nt,et,it,ot,st,at,rt,ct,lt,J,xt,vt,$,B,D,V,j,N,q,R,U],styles:["[_nghost-%COMP%]{display:block;height:100%}ion-segment[_ngcontent-%COMP%]{margin:16px 0}.chart-container[_ngcontent-%COMP%]{width:100%;padding:20px;background:#fff;border-radius:10px;box-shadow:0 2px 10px #0000001a}h3[_ngcontent-%COMP%]{text-align:center;color:#333;margin-bottom:20px}.alerts-container[_ngcontent-%COMP%]{height:calc(100% - 60px);overflow-y:auto;padding:0 10px}ion-item.critical[_ngcontent-%COMP%]{--background: rgba(255, 68, 68, .1);margin-bottom:8px;border-radius:8px}ion-item.slow-moving[_ngcontent-%COMP%]{--background: rgba(255, 193, 7, .1);margin-bottom:8px;border-radius:8px}.warehouse-select[_ngcontent-%COMP%]{margin-bottom:16px;--padding-start: 0;--inner-padding-end: 0}.insights-container[_ngcontent-%COMP%]{padding:16px}.insights-container[_ngcontent-%COMP%]   .header-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:24px}.insights-container[_ngcontent-%COMP%]   .header-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;font-weight:600}.insights-container[_ngcontent-%COMP%]   .header-section[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px}.insights-container[_ngcontent-%COMP%]   .insights-list[_ngcontent-%COMP%]{background:transparent}.insights-container[_ngcontent-%COMP%]   .insights-list[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]{margin-bottom:16px;border-radius:12px;--background: var(--ion-color-light);box-shadow:0 2px 8px #0000000f}.insights-container[_ngcontent-%COMP%]   .insights-list[_ngcontent-%COMP%]   .insight-card.low-stock[_ngcontent-%COMP%]{border-left:4px solid var(--ion-color-danger)}.insights-container[_ngcontent-%COMP%]   .insights-list[_ngcontent-%COMP%]   .insight-card.slow-moving[_ngcontent-%COMP%]{border-left:4px solid var(--ion-color-warning)}.insights-container[_ngcontent-%COMP%]   .insights-list[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.insights-container[_ngcontent-%COMP%]   .insights-list[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.1rem;font-weight:600}.insights-container[_ngcontent-%COMP%]   .insights-list[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]{margin:0;height:24px}.insights-container[_ngcontent-%COMP%]   .insights-list[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]   .locations-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-top:16px}.insights-container[_ngcontent-%COMP%]   .insights-list[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]   .locations-grid[_ngcontent-%COMP%]   .location-card[_ngcontent-%COMP%]{background:var(--ion-color-light-tint);border-radius:8px;padding:12px}.insights-container[_ngcontent-%COMP%]   .insights-list[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]   .locations-grid[_ngcontent-%COMP%]   .location-card[_ngcontent-%COMP%]   .location-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:8px;color:var(--ion-color-medium)}.insights-container[_ngcontent-%COMP%]   .insights-list[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]   .locations-grid[_ngcontent-%COMP%]   .location-card[_ngcontent-%COMP%]   .location-header[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.insights-container[_ngcontent-%COMP%]   .insights-list[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]   .locations-grid[_ngcontent-%COMP%]   .location-card[_ngcontent-%COMP%]   .stock-details[_ngcontent-%COMP%]   .stock-value[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.insights-container[_ngcontent-%COMP%]   .insights-list[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]   .locations-grid[_ngcontent-%COMP%]   .location-card[_ngcontent-%COMP%]   .stock-details[_ngcontent-%COMP%]   .stock-value[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:.9em}.insights-container[_ngcontent-%COMP%]   .insights-list[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]   .locations-grid[_ngcontent-%COMP%]   .location-card[_ngcontent-%COMP%]   .stock-details[_ngcontent-%COMP%]   .stock-value[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-weight:500;color:var(--ion-color-danger)}.insights-container[_ngcontent-%COMP%]   .insights-list[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:16px}.insights-container[_ngcontent-%COMP%]   .insights-list[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.insights-container[_ngcontent-%COMP%]   .insights-list[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:var(--ion-color-medium)}.insights-container[_ngcontent-%COMP%]   .insights-list[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   .stat-details[_ngcontent-%COMP%]{display:flex;flex-direction:column}.insights-container[_ngcontent-%COMP%]   .insights-list[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   .stat-details[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.8em;color:var(--ion-color-medium)}.insights-container[_ngcontent-%COMP%]   .insights-list[_ngcontent-%COMP%]   .insight-card[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   .stat-details[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-weight:500;color:var(--ion-color-dark)}"]});let i=a;return i})();export{Jt as StockInsightsComponent};
